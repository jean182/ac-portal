- @phase.checklists.each_with_index do |checklist, index|
  .div-spacer
    #accordionChecklist.accordion
      .card
        .card-header.d-flex.align-items-center{id: "heading-#{index}"}
          %h5.flex-grow-1.mb-0=checklist.name
          %button.btn.btn-link{"aria-controls" => "collapse-#{index}", "aria-expanded" => "true", "data-target" => "#collapse-#{index}", "data-toggle" => "collapse", type: "button"}
            = material_icon.keyboard_arrow_down
        .collapse{id: "collapse-#{index}", "aria-labelledby" => "heading-#{index}", "data-parent" => "#accordionChecklist"}
          .card-body
            - checklist.tasks.each_with_index do |task, index|
              %ul.list-unstyled
                %li
                  =task.description 
                  - @company_task = task.company_tasks.find_by(complete: true, company: @company)
                  - unless  @company_task.nil?
                    - if @company_task.approved
                      .form-control.gutter-top.text-success.text-center Approved
                    - else
                      -if current_user.is_a?(Admin)
                        = link_to 'Approve', admin_company_task_approve_path(company_id: @company.id, company_task_id: task.id), method: :put , class: 'btn btn-success gutter-top' if @company_task.approved != true
                        = link_to 'Refuse', admin_company_task_refuse_path(company_id: @company.id, company_task_id: task.id), method: :put , class: 'btn btn-danger gutter-top' if @company_task.approved != false
                      -elsif current_user.is_a?(Mentor)
                        = link_to 'Approve', mentor_company_task_approve_path(company_id: @company.id, company_task_id: task.id), method: :put , class: 'btn btn-success gutter-top' if @company_task.approved != true
                        = link_to 'Refuse', mentor_company_task_refuse_path(company_id: @company.id, company_task_id: task.id), method: :put , class: 'btn btn-danger gutter-top' if @company_task.approved != false
                  - if @phase == @company.current_phase
                    = link_to 'New Message', new_message_path(company_task_id: task.company_tasks.find_or_create_by(company: @company).id), data: { modal: true }
                  - if task.company_tasks.find_by(company: @company).present?
                    - if task.company_tasks.find_by(company: @company).messages.present?
                      %a{"aria-controls" => "collapse-comment-#{index}", "aria-expanded" => "false", "data-toggle" => "collapse", href: "#collapse-comment-#{index}", role: "button"}
                        %b="Show comments(#{task.company_tasks.find_by(company: @company).messages.count})"
                      .collapse{id: "collapse-comment-#{index}"}
                        %div{ id: "messages-#{task.company_tasks.find_or_create_by(company: @company).id}" }
                          - task.company_tasks.find_by(company: @company).messages.each do |message|
                            =render 'messages/message', message: message
